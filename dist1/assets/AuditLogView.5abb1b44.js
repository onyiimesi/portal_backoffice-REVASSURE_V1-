import{H as E}from"./Header.61007050.js";import{_ as S,a as c,u as y,o as i,c as n,b as t,t as o,d as r,w as v,l as B,n as m,v as p,F as b,k as w,e as g,s as D,f as d,h as k,r as A}from"./index.a5d27921.js";import{h as I}from"./moment.9709ab41.js";const z={name:"listorganization",data(){return{name:"",audit:[],search:"",showsearch:!1,searchs:"",showsearchs:!1,caris:[],filter:[],showpar:!1,role:"",parentOrganizationCode:"",customerDetails:{emailAddress:"",subOrganisationCode:"",organizationCode:"",firstName:"",lastName:"",middleName:"",gender:"",unit:""},modules:[],userEmail:"",action:"",startDate:"",endDate:"",loaderDiv:"",mainDiv:"d-none",roles:"0",roless:"portal-admin"}},async mounted(){this.role=localStorage.getItem("role"),this.roles!=this.role&&(localStorage.removeItem("token"),this.$router.push("/"));const a=await c.get("api/Users/profile",{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});this.customerDetails=a.data.result;const s=await c.get("api/Audit/recent",{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});this.audit=s.data.result,this.loaderDiv="d-none",this.mainDiv="",this.showpar=!1,this.showsearch=!1,setTimeout(()=>{$("#datatable").DataTable({lengthMenu:[[5,10,25,50,-1],[5,10,25,50,"All"]],pageLength:25,retrieve:!0})});const f=await c.get("api/Modules/modules",{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});this.modules=f.data.result},methods:{dateTime(a){return I(a).format("MMMM Do YYYY, h:mm:ss a")},async onChange(a){const s=await c.get("api/Organisation/organizations/"+a.target.value,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});this.allorgs=s.data.result,this.showpar=!0,this.showsearch=!1},async searchLog(){const a=y();this.search?await c.get("api/Audit/user/"+this.search,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}}).then(s=>{this.caris=s.data.result,setTimeout(()=>{$("#datatable3").DataTable({lengthMenu:[[5,10,25,50,-1],[5,10,25,50,"All"]],pageLength:25,retrieve:!0})}),this.search="",this.showsearch=!0}).catch(s=>{this.eee=s.response.data.errors}):a.error("Field can't be empty")},async searchLogFilter(){const a=y();this.userEmail||a.error("Email field can't be empty"),this.action||a.error("Action field can't be empty"),this.startDate||a.error("Specify a start date"),this.endDate?await c.post("api/Audit/search",{userEmail:this.userEmail,action:this.action,startDate:this.startDate,endDate:this.endDate},{headers:{Authorization:"Bearer "+localStorage.getItem("token")}}).then(s=>{this.filter=s.data.result,$("#datatable3").dataTable().fnDestroy(),setTimeout(()=>{$("#datatable3").DataTable({lengthMenu:[[5,10,25,50,-1],[5,10,25,50,"All"]],pageLength:25,retrieve:!0})}),this.searchs="",this.showsearchs=!0}).catch(s=>{this.eee=s.response.data.errors}):a.error("Specify an end date")}}},T={id:"layout-wrapper"},V={class:"main-content"},L={class:"page-content"},N={class:"container-fluid"},C={class:"row"},M={class:"col-12"},U={class:"page-title-box d-flex align-items-center justify-content-between"},O={class:"mb-0"},P=d("Organisations "),F=t("br",null,null,-1),Y=d(),H={style:{"font-size":"14px","font-weight":"500"}},G=d(" // "),j={style:{"font-size":"14px","font-weight":"500"}},q={class:"page-title-right"},J={class:"breadcrumb m-0"},K={class:"breadcrumb-item"},Q=d("Home"),R=t("li",{class:"breadcrumb-item active"},"Organisations",-1),W={class:"row"},X={class:"col-12"},Z={class:"card"},tt={class:"card-body"},et=t("h5",null,"Search Log",-1),st=t("hr",null,null,-1),ot={class:"row"},lt={class:"col-md-12 pl-4 pr-4"},at={class:"row"},it={class:"col-md-12"},nt={class:"row"},rt={class:"col-md-3"},dt=t("label",{for:""},"User Email",-1),ct={class:"col-md-3"},ht=t("label",{for:""},"Action",-1),ut={class:"col-md-3"},_t=t("label",{for:""},"Start Date",-1),vt={class:"col-md-3"},mt=t("label",{for:""},"End Date",-1),pt=t("button",{class:"btn btn-outline-success"},"Search",-1),bt={class:"card"},gt={class:"card-body table-responsive"},ft={key:0},wt={id:"datatable3",class:"table table-bordered dt-responsive nowrap",style:{"border-collapse":"collapse","border-spacing":"0",width:"100%"}},yt=t("thead",null,[t("tr",null,[t("th",null,"#"),t("th",null,"Email"),t("th",null,"Action"),t("th",null,"IP Address"),t("th",null,"Date"),t("th",null,"Action")])],-1),Dt=d("View"),At=t("a",{href:"/audit-log"},[t("button",{class:"btn btn-outline-success"},"Go Back")],-1),kt={key:1},xt={id:"datatable3",class:"table table-bordered dt-responsive nowrap",style:{"border-collapse":"collapse","border-spacing":"0",width:"100%"}},Et=t("thead",null,[t("tr",null,[t("th",null,"#"),t("th",null,"Email"),t("th",null,"Action"),t("th",null,"IP Address"),t("th",null,"Date"),t("th",null,"Action")])],-1),St={key:0,class:"text-center"},Bt=t("td",{colspan:"7"},[t("h5",{style:{color:"red"}},"No data available!")],-1),It=[Bt],zt=d("View"),Tt=t("a",{href:"/audit-log"},[t("button",{class:"btn btn-outline-success"},"Go Back")],-1),Vt={key:2},Lt=k('<div class="ph-item"><div class="ph-col-12"><div class="ph-row"><div class="ph-col-4"></div><div class="ph-col-8 empty"></div><div class="ph-col-6"></div><div class="ph-col-6 empty"></div><div class="ph-col-12"></div><div class="ph-col-12"></div><div class="ph-col-12"></div><div class="ph-col-12"></div></div><div class="ph-row"><div class="ph-col-4"></div><div class="ph-col-8 empty"></div><div class="ph-col-6"></div><div class="ph-col-6 empty"></div><div class="ph-col-12"></div><div class="ph-col-12"></div><div class="ph-col-12"></div><div class="ph-col-12"></div></div></div></div>',1),Nt=[Lt],Ct={id:"datatable",class:"table table-border-success table-bordered dt-responsive nowrap",style:{"border-collapse":"collapse","border-spacing":"0",width:"100%"}},Mt=t("thead",null,[t("tr",null,[t("th",null,"#"),t("th",null,"User Email"),t("th",null,"Action"),t("th",null,"Date"),t("th",null,"IP Address"),t("th")])],-1),Ut=t("div",null,null,-1),Ot=d("View"),Pt=k('<footer class="footer"><div class="container-fluid"><div class="row"><div class="col-sm-6"> BackOffice 0.1 \xA9 2022 </div><div class="col-sm-6"><div class="text-sm-right d-none d-sm-block"> Powered by Intelligence </div></div></div></div></footer>',1);function Ft(a,s,f,Ht,l,h){const _=A("router-link"),x=A("router-view");return i(),n(b,null,[t("div",T,[t("div",V,[t("div",L,[t("div",N,[t("div",C,[t("div",M,[t("div",U,[t("h4",O,[P,F,Y,t("span",H,o(l.customerDetails.organizationCode)+" // "+o(l.customerDetails.subOrganisationCode),1),G,t("span",j,o(l.customerDetails.lastName)+" "+o(l.customerDetails.firstName)+" // "+o(this.role),1)]),t("div",q,[t("ol",J,[t("li",K,[r(_,{to:"/dashboard"},{default:v(()=>[Q]),_:1})]),R])])])])]),t("div",W,[t("div",X,[t("div",Z,[t("div",tt,[et,st,t("div",ot,[t("div",lt,[t("form",{onSubmit:s[4]||(s[4]=B((...e)=>h.searchLogFilter&&h.searchLogFilter(...e),["prevent"]))},[t("div",at,[t("div",it,[t("div",nt,[t("div",rt,[dt,m(t("input",{class:"form-control mb-3",type:"text",placeholder:"Enter User Email","onUpdate:modelValue":s[0]||(s[0]=e=>l.userEmail=e)},null,512),[[p,l.userEmail]])]),t("div",ct,[ht,m(t("input",{class:"form-control mb-3",type:"text",placeholder:"Enter Action","onUpdate:modelValue":s[1]||(s[1]=e=>l.action=e)},null,512),[[p,l.action]])]),t("div",ut,[_t,m(t("input",{type:"datetime-local",class:"form-control mb-3","onUpdate:modelValue":s[2]||(s[2]=e=>l.startDate=e)},null,512),[[p,l.startDate]])]),t("div",vt,[mt,m(t("input",{type:"datetime-local",class:"form-control mb-3","onUpdate:modelValue":s[3]||(s[3]=e=>l.endDate=e)},null,512),[[p,l.endDate]])])]),pt])])],32)])])])]),t("div",bt,[t("div",gt,[this.showsearch==!0?(i(),n("div",ft,[t("table",wt,[yt,t("tbody",null,[(i(!0),n(b,null,w(l.caris,(e,u)=>(i(),n("tr",null,[t("td",null,o(u+1),1),t("td",null,o(e.createdBy),1),t("td",null,o(e.action),1),t("td",null,o(e.clientIP),1),t("td",null,o(h.dateTime(e.created)),1),t("td",null,[r(_,{class:"btn btn-outline-success",to:"/view-log/"+e.id},{default:v(()=>[Dt]),_:2},1032,["to"])])]))),256))])]),At])):g("",!0),this.showsearchs==!0?(i(),n("div",kt,[t("table",xt,[Et,t("tbody",null,[l.filter.length?g("",!0):(i(),n("tr",St,It)),(i(!0),n(b,null,w(l.filter,(e,u)=>(i(),n("tr",null,[t("td",null,o(u+1),1),t("td",null,o(e.createdBy),1),t("td",null,o(e.action),1),t("td",null,o(e.clientIP),1),t("td",null,o(h.dateTime(e.created)),1),t("td",null,[r(_,{class:"btn btn-outline-success",to:"/view-log/"+e.id},{default:v(()=>[zt]),_:2},1032,["to"])])]))),256))])]),Tt])):g("",!0),this.showsearch==!1&&this.showsearchs==!1?(i(),n("div",Vt,[t("div",{class:D(this.loaderDiv)},Nt,2),t("div",{class:D(this.mainDiv)},[t("table",Ct,[Mt,t("tbody",null,[Ut,(i(!0),n(b,null,w(l.audit,(e,u)=>(i(),n("tr",null,[t("td",null,o(u+1),1),t("td",null,o(e.createdBy),1),t("td",null,o(e.action),1),t("td",null,o(h.dateTime(e.created)),1),t("td",null,o(e.clientIP),1),t("td",null,[r(_,{class:"btn btn-outline-success",to:"/view-log/"+e.id},{default:v(()=>[Ot]),_:2},1032,["to"])])]))),256))])])],2)])):g("",!0)])])])])])]),Pt])]),r(x)],64)}var Yt=S(z,[["render",Ft]]);const Jt={__name:"AuditLogView",setup(a){return(s,f)=>(i(),n("main",null,[r(E),r(Yt)]))}};export{Jt as default};
